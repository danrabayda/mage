<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Generator</title>
  <style>
    body {
      background-color: #2c003e;
      color: #e0d7ff;
      font-family: 'Arial', sans-serif;
      text-align: center;
      padding: 20px;
    }

    h1 {
      font-size: 2.5rem;
      color: #ffccff;
    }

    label {
      font-size: 1.2rem;
      margin-right: 10px;
    }

    input, textarea, select {
      background-color: #4b0082;
      color: #e0d7ff;
      border: 1px solid #e0d7ff;
      border-radius: 5px;
      padding: 5px;
      font-size: 1rem;
    }

    textarea {
      width: 80%;
    }

    button {
      background-color: #8000ff;
      color: #ffffff;
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      font-size: 1.2rem;
      cursor: pointer;
      margin: 10px;
    }

    button:hover {
      background-color: #a64dff;
    }

    img {
      margin-top: 20px;
      border: 2px solid #e0d7ff;
      border-radius: 10px;
      max-width: 90%;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    .wizard-icon {
      font-size: 3rem;
      margin-bottom: 20px;
    }

    .input-group {
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="wizard-icon">ğŸ§™â€â™‚ï¸</div>
    <h1>Mage</h1>
    <textarea id="prompt" rows="4" placeholder="Enter your magical prompt here..."></textarea><br>

    <div class="input-group">
      <label for="steps">ğŸŒ€ Steps:</label>
      <input type="number" id="steps" value="50" min="1" max="100">
    </div>

    <div class="input-group">
      <label for="guidance">âœ¨ Guidance Scale:</label>
      <input type="number" id="guidance" value="4.5" step="0.1" min="0" max="20">
    </div>

    <div class="input-group">
      <label for="width">ğŸ“ Width:</label>
      <input type="number" id="width" value="1920" step="64" min="64">
    </div>

    <div class="input-group">
      <label for="height">ğŸ“ Height:</label>
      <input type="number" id="height" value="1080" step="64" min="64">
    </div>

    <div class="input-group">
      <label for="model">ğŸ§™â€â™€ï¸ Model:</label>
      <select id="model">
        <option value="playgroundai/playground-v2.5-1024px-aesthetic" selected>Playground v2.5</option>
        <option value="stabilityai/stable-diffusion-xl-base-1.0">Stable Diffusion XL Base 1.0</option>
      </select>
    </div>

    <button onclick="generate()">ğŸ”® Generate</button>
    <button id="saveButton" style="display: none;" onclick="saveImage()">ğŸ’¾ Save Image</button><br><br>

    <img id="img" alt="Generated Image" />
  </div>

  <script>
    const ws = new WebSocket("ws://127.0.0.1:8000/ws");
    let currentImage = null;

    function generate() {
      ws.send(JSON.stringify({
        prompt: document.getElementById("prompt").value,
        steps: parseInt(document.getElementById("steps").value),
        guidance: parseFloat(document.getElementById("guidance").value),
        width: parseInt(document.getElementById("width").value),
        height: parseInt(document.getElementById("height").value),
        model: document.getElementById("model").value
      }));

      document.getElementById("saveButton").style.display = "none";
    }

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);

      if (data.status === "done") {
        currentImage = "data:image/png;base64," + data.image;
        document.getElementById("img").src = currentImage;
        document.getElementById("saveButton").style.display = "inline-block";
      }
    };

    function saveImage() {
      if (currentImage) {
        const prompt = document.getElementById("prompt").value.trim().replace(/[^a-z0-9]/gi, '_').toLowerCase();
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
        const filename = `${prompt}_${timestamp}.png`;

        const link = document.createElement("a");
        link.href = currentImage;
        link.download = filename;
        link.click();
      }
    }
  </script>
</body>
</html>
